{"ast":null,"code":"import React,{useState,useMemo}from'react';import{searchProducts}from'../utils/api';import ProductList from'./ProductList';import'../styles/SearchPage.css';import LoadingSpinner from'./LoadingSpinner';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const SearchPage=()=>{const[keyword,setKeyword]=useState('');const[searchResults,setSearchResults]=useState({products:[]});const[loading,setLoading]=useState(false);const[error,setError]=useState(null);const[selectedProducts,setSelectedProducts]=useState([]);const[loadingMessage,setLoadingMessage]=useState('');// 스마트스토어 상품과 일반 상품 분리\nconst{smartstoreProducts,otherProducts}=useMemo(()=>{const products=(searchResults===null||searchResults===void 0?void 0:searchResults.products)||[];return{smartstoreProducts:products.filter(p=>p.is_smartstore)||[],otherProducts:products.filter(p=>!p.is_smartstore)||[]};},[searchResults]);const handleSearch=async e=>{e.preventDefault();if(!keyword.trim()){setError('검색어를 입력해주세요.');return;}setLoading(true);setLoadingMessage('상품을 검색하고 있습니다. 잠시만 기다려주세요...');setError(null);try{const result=await searchProducts(keyword);if(result&&result.products){setSearchResults(result);}else{throw new Error('검색 결과가 없습니다.');}}catch(err){console.error('Search error:',err);setError(err.message||'검색 중 오류가 발생했습니다.');}finally{setLoading(false);setLoadingMessage('');}};const handleProductSelect=productId=>{setSelectedProducts(prev=>{if(prev.includes(productId)){return prev.filter(id=>id!==productId);}else{return[...prev,productId];}});};const handleCollect=async type=>{if(selectedProducts.length===0){setError('수집할 상품을 선택해주세요.');return;}setLoading(true);setLoadingMessage(type==='market'?'마켓 정보를 수집하고 있습니다...':'상품 정보를 수집하고 있습니다...');try{const uid=localStorage.getItem('uid');if(!uid){throw new Error('로그인이 필요합니다.');}const selectedItems=searchResults.products.filter(p=>selectedProducts.includes(p.id));const response=await fetch('http://localhost:5000/collect',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({uid,type,selected_items:selectedItems})});const result=await response.json();if(response.ok){alert(result.message);setSelectedProducts([]);}else{throw new Error(result.error);}}catch(err){setError(err.message||'수집 중 오류가 발생했습니다.');}finally{setLoading(false);setLoadingMessage('');}};return/*#__PURE__*/_jsxs(\"div\",{className:\"search-page\",children:[loading&&/*#__PURE__*/_jsx(LoadingSpinner,{message:loadingMessage}),/*#__PURE__*/_jsxs(\"form\",{onSubmit:handleSearch,className:\"search-form\",children:[/*#__PURE__*/_jsx(\"input\",{type:\"text\",value:keyword,onChange:e=>setKeyword(e.target.value),placeholder:\"\\uAC80\\uC0C9\\uC5B4\\uB97C \\uC785\\uB825\\uD558\\uC138\\uC694\",className:\"search-input\"}),/*#__PURE__*/_jsx(\"button\",{type:\"submit\",className:\"search-button\",disabled:loading,children:loading?'검색 중...':'검색'})]}),error&&/*#__PURE__*/_jsx(\"div\",{className:\"error-message\",children:error}),/*#__PURE__*/_jsxs(\"div\",{className:\"results-container\",children:[smartstoreProducts.length>0&&/*#__PURE__*/_jsxs(\"div\",{className:\"product-section\",children:[/*#__PURE__*/_jsxs(\"h2\",{children:[\"\\uC2A4\\uB9C8\\uD2B8\\uC2A4\\uD1A0\\uC5B4 \\uC0C1\\uD488 (\",smartstoreProducts.length,\")\"]}),/*#__PURE__*/_jsx(ProductList,{products:smartstoreProducts,selectedProducts:selectedProducts,onProductSelect:handleProductSelect})]}),otherProducts.length>0&&/*#__PURE__*/_jsxs(\"div\",{className:\"product-section\",children:[/*#__PURE__*/_jsxs(\"h2\",{children:[\"\\uC77C\\uBC18 \\uC0C1\\uD488 (\",otherProducts.length,\")\"]}),/*#__PURE__*/_jsx(ProductList,{products:otherProducts,selectedProducts:selectedProducts,onProductSelect:handleProductSelect})]}),!loading&&searchResults.products&&searchResults.products.length===0&&/*#__PURE__*/_jsx(\"div\",{className:\"no-results\",children:\"\\uAC80\\uC0C9 \\uACB0\\uACFC\\uAC00 \\uC5C6\\uC2B5\\uB2C8\\uB2E4.\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"action-buttons\",children:[/*#__PURE__*/_jsx(\"button\",{onClick:()=>handleCollect('market'),disabled:selectedProducts.length===0,className:\"collect-button\",children:\"\\uB9C8\\uCF13 \\uC218\\uC9D1\"}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>handleCollect('product'),disabled:selectedProducts.length===0,className:\"collect-button\",children:\"\\uC0C1\\uD488 \\uC218\\uC9D1\"})]})]});};export default SearchPage;","map":{"version":3,"names":["React","useState","useMemo","searchProducts","ProductList","LoadingSpinner","jsx","_jsx","jsxs","_jsxs","SearchPage","keyword","setKeyword","searchResults","setSearchResults","products","loading","setLoading","error","setError","selectedProducts","setSelectedProducts","loadingMessage","setLoadingMessage","smartstoreProducts","otherProducts","filter","p","is_smartstore","handleSearch","e","preventDefault","trim","result","Error","err","console","message","handleProductSelect","productId","prev","includes","id","handleCollect","type","length","uid","localStorage","getItem","selectedItems","response","fetch","method","headers","body","JSON","stringify","selected_items","json","ok","alert","className","children","onSubmit","value","onChange","target","placeholder","disabled","onProductSelect","onClick"],"sources":["C:/자동ai/front/my-app/src/components/SearchPage.js"],"sourcesContent":["import React, { useState, useMemo } from 'react';\nimport { searchProducts } from '../utils/api';\nimport ProductList from './ProductList';\nimport '../styles/SearchPage.css';\nimport LoadingSpinner from './LoadingSpinner';\n\nconst SearchPage = () => {\n  const [keyword, setKeyword] = useState('');\n  const [searchResults, setSearchResults] = useState({ products: [] });\n  const [loading, setLoading] = useState(false);\n  const [error, setError] = useState(null);\n  const [selectedProducts, setSelectedProducts] = useState([]);\n  const [loadingMessage, setLoadingMessage] = useState('');\n\n  // 스마트스토어 상품과 일반 상품 분리\n  const { smartstoreProducts, otherProducts } = useMemo(() => {\n    const products = searchResults?.products || [];\n    return {\n      smartstoreProducts: products.filter(p => p.is_smartstore) || [],\n      otherProducts: products.filter(p => !p.is_smartstore) || []\n    };\n  }, [searchResults]);\n\n  const handleSearch = async (e) => {\n    e.preventDefault();\n    if (!keyword.trim()) {\n      setError('검색어를 입력해주세요.');\n      return;\n    }\n\n    setLoading(true);\n    setLoadingMessage('상품을 검색하고 있습니다. 잠시만 기다려주세요...');\n    setError(null);\n\n    try {\n      const result = await searchProducts(keyword);\n      if (result && result.products) {\n        setSearchResults(result);\n      } else {\n        throw new Error('검색 결과가 없습니다.');\n      }\n    } catch (err) {\n      console.error('Search error:', err);\n      setError(err.message || '검색 중 오류가 발생했습니다.');\n    } finally {\n      setLoading(false);\n      setLoadingMessage('');\n    }\n  };\n\n  const handleProductSelect = (productId) => {\n    setSelectedProducts(prev => {\n      if (prev.includes(productId)) {\n        return prev.filter(id => id !== productId);\n      } else {\n        return [...prev, productId];\n      }\n    });\n  };\n\n  const handleCollect = async (type) => {\n    if (selectedProducts.length === 0) {\n      setError('수집할 상품을 선택해주세요.');\n      return;\n    }\n\n    setLoading(true);\n    setLoadingMessage(type === 'market' ? '마켓 정보를 수집하고 있습니다...' : '상품 정보를 수집하고 있습니다...');\n\n    try {\n      const uid = localStorage.getItem('uid');\n      if (!uid) {\n        throw new Error('로그인이 필요합니다.');\n      }\n\n      const selectedItems = searchResults.products.filter(p => \n        selectedProducts.includes(p.id)\n      );\n\n      const response = await fetch('http://localhost:5000/collect', {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n        },\n        body: JSON.stringify({\n          uid,\n          type,\n          selected_items: selectedItems\n        })\n      });\n\n      const result = await response.json();\n      if (response.ok) {\n        alert(result.message);\n        setSelectedProducts([]);\n      } else {\n        throw new Error(result.error);\n      }\n    } catch (err) {\n      setError(err.message || '수집 중 오류가 발생했습니다.');\n    } finally {\n      setLoading(false);\n      setLoadingMessage('');\n    }\n  };\n\n  return (\n    <div className=\"search-page\">\n      {loading && <LoadingSpinner message={loadingMessage} />}\n      <form onSubmit={handleSearch} className=\"search-form\">\n        <input\n          type=\"text\"\n          value={keyword}\n          onChange={(e) => setKeyword(e.target.value)}\n          placeholder=\"검색어를 입력하세요\"\n          className=\"search-input\"\n        />\n        <button type=\"submit\" className=\"search-button\" disabled={loading}>\n          {loading ? '검색 중...' : '검색'}\n        </button>\n      </form>\n\n      {error && <div className=\"error-message\">{error}</div>}\n\n      <div className=\"results-container\">\n        {smartstoreProducts.length > 0 && (\n          <div className=\"product-section\">\n            <h2>스마트스토어 상품 ({smartstoreProducts.length})</h2>\n            <ProductList \n              products={smartstoreProducts}\n              selectedProducts={selectedProducts}\n              onProductSelect={handleProductSelect}\n            />\n          </div>\n        )}\n\n        {otherProducts.length > 0 && (\n          <div className=\"product-section\">\n            <h2>일반 상품 ({otherProducts.length})</h2>\n            <ProductList \n              products={otherProducts}\n              selectedProducts={selectedProducts}\n              onProductSelect={handleProductSelect}\n            />\n          </div>\n        )}\n\n        {!loading && searchResults.products && searchResults.products.length === 0 && (\n          <div className=\"no-results\">검색 결과가 없습니다.</div>\n        )}\n      </div>\n\n      <div className=\"action-buttons\">\n        <button \n          onClick={() => handleCollect('market')} \n          disabled={selectedProducts.length === 0}\n          className=\"collect-button\"\n        >\n          마켓 수집\n        </button>\n        <button \n          onClick={() => handleCollect('product')} \n          disabled={selectedProducts.length === 0}\n          className=\"collect-button\"\n        >\n          상품 수집\n        </button>\n      </div>\n    </div>\n  );\n};\n\nexport default SearchPage;\n"],"mappings":"AAAA,MAAO,CAAAA,KAAK,EAAIC,QAAQ,CAAEC,OAAO,KAAQ,OAAO,CAChD,OAASC,cAAc,KAAQ,cAAc,CAC7C,MAAO,CAAAC,WAAW,KAAM,eAAe,CACvC,MAAO,0BAA0B,CACjC,MAAO,CAAAC,cAAc,KAAM,kBAAkB,CAAC,OAAAC,GAAA,IAAAC,IAAA,CAAAC,IAAA,IAAAC,KAAA,yBAE9C,KAAM,CAAAC,UAAU,CAAGA,CAAA,GAAM,CACvB,KAAM,CAACC,OAAO,CAAEC,UAAU,CAAC,CAAGX,QAAQ,CAAC,EAAE,CAAC,CAC1C,KAAM,CAACY,aAAa,CAAEC,gBAAgB,CAAC,CAAGb,QAAQ,CAAC,CAAEc,QAAQ,CAAE,EAAG,CAAC,CAAC,CACpE,KAAM,CAACC,OAAO,CAAEC,UAAU,CAAC,CAAGhB,QAAQ,CAAC,KAAK,CAAC,CAC7C,KAAM,CAACiB,KAAK,CAAEC,QAAQ,CAAC,CAAGlB,QAAQ,CAAC,IAAI,CAAC,CACxC,KAAM,CAACmB,gBAAgB,CAAEC,mBAAmB,CAAC,CAAGpB,QAAQ,CAAC,EAAE,CAAC,CAC5D,KAAM,CAACqB,cAAc,CAAEC,iBAAiB,CAAC,CAAGtB,QAAQ,CAAC,EAAE,CAAC,CAExD;AACA,KAAM,CAAEuB,kBAAkB,CAAEC,aAAc,CAAC,CAAGvB,OAAO,CAAC,IAAM,CAC1D,KAAM,CAAAa,QAAQ,CAAG,CAAAF,aAAa,SAAbA,aAAa,iBAAbA,aAAa,CAAEE,QAAQ,GAAI,EAAE,CAC9C,MAAO,CACLS,kBAAkB,CAAET,QAAQ,CAACW,MAAM,CAACC,CAAC,EAAIA,CAAC,CAACC,aAAa,CAAC,EAAI,EAAE,CAC/DH,aAAa,CAAEV,QAAQ,CAACW,MAAM,CAACC,CAAC,EAAI,CAACA,CAAC,CAACC,aAAa,CAAC,EAAI,EAC3D,CAAC,CACH,CAAC,CAAE,CAACf,aAAa,CAAC,CAAC,CAEnB,KAAM,CAAAgB,YAAY,CAAG,KAAO,CAAAC,CAAC,EAAK,CAChCA,CAAC,CAACC,cAAc,CAAC,CAAC,CAClB,GAAI,CAACpB,OAAO,CAACqB,IAAI,CAAC,CAAC,CAAE,CACnBb,QAAQ,CAAC,cAAc,CAAC,CACxB,OACF,CAEAF,UAAU,CAAC,IAAI,CAAC,CAChBM,iBAAiB,CAAC,8BAA8B,CAAC,CACjDJ,QAAQ,CAAC,IAAI,CAAC,CAEd,GAAI,CACF,KAAM,CAAAc,MAAM,CAAG,KAAM,CAAA9B,cAAc,CAACQ,OAAO,CAAC,CAC5C,GAAIsB,MAAM,EAAIA,MAAM,CAAClB,QAAQ,CAAE,CAC7BD,gBAAgB,CAACmB,MAAM,CAAC,CAC1B,CAAC,IAAM,CACL,KAAM,IAAI,CAAAC,KAAK,CAAC,cAAc,CAAC,CACjC,CACF,CAAE,MAAOC,GAAG,CAAE,CACZC,OAAO,CAAClB,KAAK,CAAC,eAAe,CAAEiB,GAAG,CAAC,CACnChB,QAAQ,CAACgB,GAAG,CAACE,OAAO,EAAI,kBAAkB,CAAC,CAC7C,CAAC,OAAS,CACRpB,UAAU,CAAC,KAAK,CAAC,CACjBM,iBAAiB,CAAC,EAAE,CAAC,CACvB,CACF,CAAC,CAED,KAAM,CAAAe,mBAAmB,CAAIC,SAAS,EAAK,CACzClB,mBAAmB,CAACmB,IAAI,EAAI,CAC1B,GAAIA,IAAI,CAACC,QAAQ,CAACF,SAAS,CAAC,CAAE,CAC5B,MAAO,CAAAC,IAAI,CAACd,MAAM,CAACgB,EAAE,EAAIA,EAAE,GAAKH,SAAS,CAAC,CAC5C,CAAC,IAAM,CACL,MAAO,CAAC,GAAGC,IAAI,CAAED,SAAS,CAAC,CAC7B,CACF,CAAC,CAAC,CACJ,CAAC,CAED,KAAM,CAAAI,aAAa,CAAG,KAAO,CAAAC,IAAI,EAAK,CACpC,GAAIxB,gBAAgB,CAACyB,MAAM,GAAK,CAAC,CAAE,CACjC1B,QAAQ,CAAC,iBAAiB,CAAC,CAC3B,OACF,CAEAF,UAAU,CAAC,IAAI,CAAC,CAChBM,iBAAiB,CAACqB,IAAI,GAAK,QAAQ,CAAG,qBAAqB,CAAG,qBAAqB,CAAC,CAEpF,GAAI,CACF,KAAM,CAAAE,GAAG,CAAGC,YAAY,CAACC,OAAO,CAAC,KAAK,CAAC,CACvC,GAAI,CAACF,GAAG,CAAE,CACR,KAAM,IAAI,CAAAZ,KAAK,CAAC,aAAa,CAAC,CAChC,CAEA,KAAM,CAAAe,aAAa,CAAGpC,aAAa,CAACE,QAAQ,CAACW,MAAM,CAACC,CAAC,EACnDP,gBAAgB,CAACqB,QAAQ,CAACd,CAAC,CAACe,EAAE,CAChC,CAAC,CAED,KAAM,CAAAQ,QAAQ,CAAG,KAAM,CAAAC,KAAK,CAAC,+BAA+B,CAAE,CAC5DC,MAAM,CAAE,MAAM,CACdC,OAAO,CAAE,CACP,cAAc,CAAE,kBAClB,CAAC,CACDC,IAAI,CAAEC,IAAI,CAACC,SAAS,CAAC,CACnBV,GAAG,CACHF,IAAI,CACJa,cAAc,CAAER,aAClB,CAAC,CACH,CAAC,CAAC,CAEF,KAAM,CAAAhB,MAAM,CAAG,KAAM,CAAAiB,QAAQ,CAACQ,IAAI,CAAC,CAAC,CACpC,GAAIR,QAAQ,CAACS,EAAE,CAAE,CACfC,KAAK,CAAC3B,MAAM,CAACI,OAAO,CAAC,CACrBhB,mBAAmB,CAAC,EAAE,CAAC,CACzB,CAAC,IAAM,CACL,KAAM,IAAI,CAAAa,KAAK,CAACD,MAAM,CAACf,KAAK,CAAC,CAC/B,CACF,CAAE,MAAOiB,GAAG,CAAE,CACZhB,QAAQ,CAACgB,GAAG,CAACE,OAAO,EAAI,kBAAkB,CAAC,CAC7C,CAAC,OAAS,CACRpB,UAAU,CAAC,KAAK,CAAC,CACjBM,iBAAiB,CAAC,EAAE,CAAC,CACvB,CACF,CAAC,CAED,mBACEd,KAAA,QAAKoD,SAAS,CAAC,aAAa,CAAAC,QAAA,EACzB9C,OAAO,eAAIT,IAAA,CAACF,cAAc,EAACgC,OAAO,CAAEf,cAAe,CAAE,CAAC,cACvDb,KAAA,SAAMsD,QAAQ,CAAElC,YAAa,CAACgC,SAAS,CAAC,aAAa,CAAAC,QAAA,eACnDvD,IAAA,UACEqC,IAAI,CAAC,MAAM,CACXoB,KAAK,CAAErD,OAAQ,CACfsD,QAAQ,CAAGnC,CAAC,EAAKlB,UAAU,CAACkB,CAAC,CAACoC,MAAM,CAACF,KAAK,CAAE,CAC5CG,WAAW,CAAC,yDAAY,CACxBN,SAAS,CAAC,cAAc,CACzB,CAAC,cACFtD,IAAA,WAAQqC,IAAI,CAAC,QAAQ,CAACiB,SAAS,CAAC,eAAe,CAACO,QAAQ,CAAEpD,OAAQ,CAAA8C,QAAA,CAC/D9C,OAAO,CAAG,SAAS,CAAG,IAAI,CACrB,CAAC,EACL,CAAC,CAENE,KAAK,eAAIX,IAAA,QAAKsD,SAAS,CAAC,eAAe,CAAAC,QAAA,CAAE5C,KAAK,CAAM,CAAC,cAEtDT,KAAA,QAAKoD,SAAS,CAAC,mBAAmB,CAAAC,QAAA,EAC/BtC,kBAAkB,CAACqB,MAAM,CAAG,CAAC,eAC5BpC,KAAA,QAAKoD,SAAS,CAAC,iBAAiB,CAAAC,QAAA,eAC9BrD,KAAA,OAAAqD,QAAA,EAAI,qDAAW,CAACtC,kBAAkB,CAACqB,MAAM,CAAC,GAAC,EAAI,CAAC,cAChDtC,IAAA,CAACH,WAAW,EACVW,QAAQ,CAAES,kBAAmB,CAC7BJ,gBAAgB,CAAEA,gBAAiB,CACnCiD,eAAe,CAAE/B,mBAAoB,CACtC,CAAC,EACC,CACN,CAEAb,aAAa,CAACoB,MAAM,CAAG,CAAC,eACvBpC,KAAA,QAAKoD,SAAS,CAAC,iBAAiB,CAAAC,QAAA,eAC9BrD,KAAA,OAAAqD,QAAA,EAAI,6BAAO,CAACrC,aAAa,CAACoB,MAAM,CAAC,GAAC,EAAI,CAAC,cACvCtC,IAAA,CAACH,WAAW,EACVW,QAAQ,CAAEU,aAAc,CACxBL,gBAAgB,CAAEA,gBAAiB,CACnCiD,eAAe,CAAE/B,mBAAoB,CACtC,CAAC,EACC,CACN,CAEA,CAACtB,OAAO,EAAIH,aAAa,CAACE,QAAQ,EAAIF,aAAa,CAACE,QAAQ,CAAC8B,MAAM,GAAK,CAAC,eACxEtC,IAAA,QAAKsD,SAAS,CAAC,YAAY,CAAAC,QAAA,CAAC,2DAAY,CAAK,CAC9C,EACE,CAAC,cAENrD,KAAA,QAAKoD,SAAS,CAAC,gBAAgB,CAAAC,QAAA,eAC7BvD,IAAA,WACE+D,OAAO,CAAEA,CAAA,GAAM3B,aAAa,CAAC,QAAQ,CAAE,CACvCyB,QAAQ,CAAEhD,gBAAgB,CAACyB,MAAM,GAAK,CAAE,CACxCgB,SAAS,CAAC,gBAAgB,CAAAC,QAAA,CAC3B,2BAED,CAAQ,CAAC,cACTvD,IAAA,WACE+D,OAAO,CAAEA,CAAA,GAAM3B,aAAa,CAAC,SAAS,CAAE,CACxCyB,QAAQ,CAAEhD,gBAAgB,CAACyB,MAAM,GAAK,CAAE,CACxCgB,SAAS,CAAC,gBAAgB,CAAAC,QAAA,CAC3B,2BAED,CAAQ,CAAC,EACN,CAAC,EACH,CAAC,CAEV,CAAC,CAED,cAAe,CAAApD,UAAU","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}